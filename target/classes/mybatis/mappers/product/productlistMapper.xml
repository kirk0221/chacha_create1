<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.chacha.create.common.mapper.product.ProductlistMapper">

	<select id="selectAllByStoreUrl"
	resultType="com.chacha.create.common.dto.ProductlistDTO">
	
	SELECT 
    p_img.p_img_url, 
    p.product_id,
    p.product_name, 
    p.price, 
    p.stock, 
    t.type_category_name, 
    u.u_category_name,
    d.d_category_name, 
    p.product_date, 
    p.last_modified_date, 
    p.flagship_check
	FROM 
	    product p
	JOIN 
	    p_img p_img ON p.product_id = p_img.product_id
	JOIN
	    type_category t using (type_category_id)
	JOIN
	    d_category d using (d_category_id) 
	JOIN
	    u_category u using (u_category_id)
	JOIN
	    store s using (store_id)
	WHERE 
	    p_img.p_img_enum = 'THUMBNAIL' 
	    AND p_img.p_img_seq = 1
	    AND p.delete_check = 0
	    AND s.store_url = #{storeUrl}
	</select>
	
	<update id="updateFlagship" parameterType="com.chacha.create.common.dto.ProductlistDTO">
    UPDATE product
    SET flagship_check = #{flagshipCheck}
    WHERE product_id = #{productId}
    and delete_check = 0
	</update>
	
	<select id="countFlagshipByStoreId" parameterType="string" resultType="int">
    SELECT COUNT(*)
    FROM product p
    JOIN store s ON p.store_id = s.store_id
    WHERE s.store_url = #{storeUrl}
      AND p.flagship_check = 1
      AND p.delete_check = 0
	</select>
	
	<update id="updateDeleteCheck" parameterType="int">
    UPDATE product
    SET delete_check = 1
    WHERE product_id = #{productId}
      AND delete_check = 0
	</update>
	
</mapper>